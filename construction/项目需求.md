# 项目需求：AI 深度参与 Repo 模板（Provider-agnostic）

## 0. 一句话目标
用一套仓库内 SSOT（skills/workflows/commands + 项目指令）与跨平台脚本，在不同 LLM/IDE 工具间实现“无感切换”的 AI 友好 repo 模板。

## 1. 背景与问题
在 AI 深度参与（结对编程、审阅、重构、写文档、跑工具）的研发中，常见痛点：
- 上下文难长期沉淀（会话重置/换人接手/多仓库并行）
- 知识与流程难被稳定消费（需要人工记忆；不同工具对“技能/工作流”的载体不一致）
- provider/IDE 工具链对目录与配置约定不同，迁移/切换成本高

## 2. 总体目标与原则
### 2.1 总体目标
- 默认以 **OpenAI Codex** 为主要参考落地路径，但不锁定任何 provider
- 真正实现 provider-agnostic：同一套 SSOT 可生成/同步到不同 provider 所需产物形态
- 切换体验尽量无感：由入口文档引导 LLM 调用脚本完成切换/同步

### 2.2 设计原则（约束）
- **SSOT 优先**：仓库内仅维护一份事实源；禁止长期手工维护多套分叉
- **适配器生成产物**：`SSOT → adapters → provider artifacts`，以生成/同步代替复制粘贴
- **脚本幂等**：可重复执行；同一输入生成一致产物；失败可回滚或至少不破坏现状
- **无 hooks 依赖**：当前阶段不依赖 hooks/自动激活机制，完全依赖 skills 规范与可读的工作流文档
- **文档是参考**：知识文档与样例为“参考/可选”，不是硬性要求（可裁剪、可替换）

## 3. 术语与核心概念
- **Provider**：目标工具/平台的身份与产物形态。本项目需支持：`codex`、`claude`、`cursor`、`copilot`、`gemini`。
- **SSOT（Single Source of Truth）**：仓库内维护的唯一源，包括：
  - `.ai/ssot/skills/`：技能（知识 + 规则 + 资源）
  - `.ai/ssot/workflows/`（或 `.ai/ssot/agents/`）：工作流提示词/操作手册，本质视作 skill 的 workflow 形态
  - `.ai/ssot/commands/`：可复用命令/子流程（纳入 MVP）
- **Adapters**：把 SSOT 转换为 provider 产物（目录/文件名/入口文档/安装包/说明等），并保证遵循本模板规范。
- **初始化目录**：用于“先搭架子→逐步完善需求”的工作区（当前可用 `construction/`，模板可采用 `init/`）。
- **Project Profile**：初始化产物，用于后续适配与维护输入，需同时保留：
  - `project-profile.yaml`
  - `project-profile.json`

### 3.1 模板规范（路径与命名）
> 切换脚本可以“自适应生成不同形态”，但所有产物的路径与文件名必须符合本模板规范，避免 provider 分叉导致维护成本上升。

- **SSOT 根目录（不放仓库根目录）**：`.ai/ssot/`
- **SSOT 固定目录名**：`.ai/ssot/skills/`、`.ai/ssot/workflows/`（或 `.ai/ssot/agents/`）、`.ai/ssot/commands/`
- **Provider 产物目录（优先遵循 provider 规范）**：`.<provider>/skills/`
  - Codex（文档约定）：`.codex/skills/`
  - Claude Code（文档约定）：`.claude/skills/`
  - 其他 provider（本模板约定）：`.cursor/skills/`、`.copilot/skills/`、`.gemini/skills/`（由脚本/适配层映射到各自可用形态）
- **模板源文件目录（不放仓库根目录）**：`.ai/templates/`
- **适配器实现/中间层目录（不放仓库根目录）**：`.ai/providers/<provider>/`（存放 adapters/模板/映射定义；不是最终产物入口）
- **入口与指令文件**：`README.md`、`AGENTS.md`、`CLAUDE.md`（可由脚本生成/同步，但命名固定）
- **初始化目录**：`construction/`（当前）或模板中的 `init/`（建议），并在其中固定保存 `project-profile.yaml/json`

## 4. 范围
### 4.1 范围（IN）
- Repo 模板：目录结构、指令文档、示例、脚本
- SSOT：`.ai/ssot/skills/`、`.ai/ssot/workflows/`、`.ai/ssot/commands/` 的组织规范与示例
- Adapters：至少实现 `codex`；并提供 `claude` 作为额外适配示例（其余 provider 允许以“最小适配/占位”进入迭代）
- 跨平台脚本：PowerShell + Bash
- 初始化材料：初始化 skill 文档 + 常见项目信息收集清单/问卷 + Project Profile 产物

### 4.2 非目标（OUT）
- 不交付可运行的业务应用（模板是基础设施/方法论）
- 不强绑定具体技术栈（语言/框架尽量可替换）
- 当前阶段不交付 hooks 驱动的提示/路由/自动激活机制

## 5. 需求（MUST / SHOULD）
### 5.1 Provider 无感切换（MUST）
- 入口文档（例如 `README.md`）必须明确要求 LLM 调用项目提供的切换脚本完成切换。
- 切换脚本必须允许 LLM 声明自身身份（provider），并支持：`codex/claude/cursor/copilot/gemini`。
- 脚本可对不同 provider 做自适应（生成不同产物形态），但**产物的路径与文件名必须遵循本模板规范**（由 adapters 定义），避免随意分叉。

### 5.2 交互式初始化（MUST）
- 提供 PowerShell 与 Bash 两套初始化入口（可同名不同后缀），通过交互收集：
  - 项目需求信息：目标、业务、数据流、复杂程度等
  - 开发信息：前后端框架、主要语言、仓库形态（单体/多包/多服务）等
- 初始化流程必须在初始化目录下生成并保留 `project-profile.yaml` 与 `project-profile.json`。
- 初始化流程可作为脚本交付，也可沉淀为一个“初始化 skill”（共享同一套问题集与输出规范）。

### 5.3 SSOT 内容与组织（MUST）
- 仓库内维护一份 SSOT（`.ai/ssot/skills/`、`.ai/ssot/workflows/`、`.ai/ssot/commands/`），并提供统一的组织规范：
  - 模块化与渐进式披露（主文档 + resources 拆分）
  - 文件体积约束与导航方式
- `.ai/ssot/workflows/`（或 `.ai/ssot/agents/`）下的文档，明确定位为 workflow 形态的 skill（提示词/操作手册），与 `.ai/ssot/skills/` 一并纳入适配与分发。
- 必须将 `construction/ai_friendly_example_repo/.claude/{skills,agents}/` 规范化转换并纳入 SSOT（skills → `.ai/ssot/skills/`；agents → `.ai/ssot/workflows/`），确保可被各 provider 产物消费。

### 5.4 Codex 默认路径（MUST）
- 默认 provider 为 `codex`：文档与脚本需确保 Codex 路径可走通（项目内指令文档 + skills 安装/更新说明/脚本）。
- Codex 的 repo skills 目录采用 `.codex/skills/`（由 Codex 官方文档定义的 REPO scope 路径之一）。
- 仓库内 `.ai/ssot/skills/` 为 SSOT；Codex 场景下允许将生成产物分发到本地 skills 目录（如 `$CODEX_HOME/skills`），但 SSOT 仍以仓库为准。

### 5.5 文档体系（SHOULD）
- 提供项目指令文件的模板与写法（例如 `AGENTS.md`、`CLAUDE.md`），并明确作用域/优先级/维护方式。
- 提供 Dev Docs Pattern 示例，用于上下文重置后的知识续航。

### 5.6 最小校验（MAY）
- 提供 CI/脚本校验：SSOT 结构有效、关键文件存在、JSON/YAML 可解析、命名符合规范等。

## 6. 交付物（Deliverables）
### 6.1 目录与文件（建议）
- `.ai/ssot/skills/`：skills SSOT
- `.ai/ssot/workflows/`（或 `.ai/ssot/agents/`）：workflow SSOT（视作 skill）
- `.ai/ssot/commands/`：commands SSOT（纳入 MVP）
- `.ai/templates/`：模板源文件（provider 无关的抽象层/可复用片段）
- `.ai/providers/<provider>/`：adapters/模板/映射定义（生成逻辑与中间层，不作为最终产物入口）
- `.<provider>/`：生成后的 provider 产物目录（最终入口之一），例如 `.codex/skills/`、`.claude/skills/`
- `docs/`：规范文档（例如 `docs/documentation-guidelines.md`、`docs/naming-conventions.md`、技能规范、贡献指南等）
- `scripts/`
  - `setup`：交互初始化 + 生成产物
  - `switch-provider`：根据 LLM 声明身份切换/同步产物（可与 setup 合并，但接口需明确）
  - `install-skills`：Codex 场景下把 SSOT 分发到本地 skills（可选）
- `construction/`（或 `init/`）：初始化材料目录（包含 `project-profile.yaml/json`）
- `README.md`：入口文档（必须引导 LLM 调用脚本）
- `AGENTS.md` / `CLAUDE.md`：项目指令（按需生成/同步）

### 6.2 参考输入（需要规范化）
- `construction/ai_friendly_example_repo/`：作为参考实现与参考文档来源；需要抽取可复用结构与方法，并标注“可直接复制/需定制/仅参考”。
- 必须将 `construction/ai_friendly_example_repo/.claude/` 下的既有资产转换为“各 provider 可用的 skill”：
  - `construction/ai_friendly_example_repo/.claude/skills/` → 规范化进入 `.ai/ssot/skills/`
  - `construction/ai_friendly_example_repo/.claude/agents/` → 视作 workflow 形态的 skill，规范化进入 `.ai/ssot/workflows/`（或 `.ai/ssot/agents/`）
  - 以上 SSOT 通过 adapters 生成/同步到目标 provider 的产物目录：例如 `.codex/skills/`、`.claude/skills/`、`.cursor/skills/`、`.copilot/skills/`、`.gemini/skills/`

## 7. MVP 定义
- 必含：SSOT（`.ai/ssot/skills/` + `.ai/ssot/workflows/` + `.ai/ssot/commands/`）+ adapters 基础框架 + `codex` 适配可用 + commands 纳入生成/同步
- 必含：PowerShell + Bash 的交互式初始化与 provider 切换
- 不含：hooks 驱动的提示/路由/自动激活机制

## 8. 验收标准（Acceptance Criteria）
1. 从模板创建新仓库后，可在 10–30 分钟内完成：交互收集信息 → 生成产物 → 验证通过。
2. LLM 按 `README.md` 指引调用切换脚本并声明 provider 后，可自动完成必要的文档/目录/配置同步。
3. Codex 路径可走通：项目内指令可被遵循；skills 的安装/更新流程明确且可重复执行；SSOT 不分叉。
4. SSOT 与适配产物边界清晰：SSOT 是唯一源；适配产物可随时重建；无需人工维护两套内容。
5. `construction/ai_friendly_example_repo/.claude/{skills,agents}/` 已完成规范化迁移到 `.ai/ssot/`，并可由 adapters 生成到至少 `codex` 与 `claude` 的 project skills 目录（如 `.codex/skills/`、`.claude/skills/`）。

## 9. 里程碑（建议）
- v0：确定目录/命名规范；完成 README 快速路径；完成脚本接口草案与最小可运行的 `codex` 生成/同步
- v1：补齐交互式初始化（含 Project Profile）；完成至少一个额外 provider（优先 `claude`）适配示例；纳入 `.ai/ssot/commands/`
- v2：增加校验与更多 provider 的适配完善（`cursor/copilot/gemini`），以及更完整的文档与示例库

## 10. 参考
- Claude skills：https://code.claude.com/docs/en/skills
- OpenAI Codex skills：https://developers.openai.com/codex/skills/

## 附录 A：初始化信息收集清单（草案）
### A.1 项目需求信息
- 项目目标与成功标准
- 业务域与关键对象
- 主要数据流/交互流（入口 → 核心流程 → 输出）
- 复杂度与约束（性能/合规/多租户/离线等）

### A.2 开发信息
- 前端框架/语言/构建工具
- 后端框架/语言/部署形态
- 仓库结构（单体/多包/多服务）与目录约定
- 测试策略与质量门禁（如有）
